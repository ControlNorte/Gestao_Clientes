{% extends "base.html" %}

{% block title %}Importar clientes{% endblock %}

{% block content %}
{% with current_url=request.resolver_match.url_name %}
<main class="pt-8 pb-16 bg-gray-50 min-h-screen">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

    <section
      class="relative overflow-hidden rounded-3xl bg-[#311E5C] text-white shadow-xl mb-8 transition-all hover:shadow-2xl">
      <div class="absolute top-0 right-0 -mr-16 -mt-16 w-80 h-80 bg-[#FFC42E] opacity-10 blur-3xl rounded-full"></div>
      <div class="absolute bottom-0 left-0 -ml-16 -mb-16 w-72 h-72 bg-[#7c3aed] opacity-20 blur-3xl rounded-full"></div>
      <div class="relative px-8 py-10">
        <p class="text-sm uppercase tracking-widest text-white/70 mb-1">Clientes</p>
        <h1 class="text-3xl font-bold mb-3">Importar clientes via XLSX</h1>
        <p class="text-white/80">Envie uma planilha com os campos previstos para acelerar o cadastro.</p>
      </div>
    </section>

    <nav class="border-b border-[#C9CBCC]/60 mb-8">
      <ul class="flex flex-wrap gap-4 text-sm font-medium text-[#311E5C]/80">
        <li>
          <a href="{% url 'clientes:dashboard' %}"
            class="inline-block px-3 py-2 {% if current_url == 'dashboard' %}text-[#311E5C] border-b-2 border-[#FFC42E]{% else %}hover:text-[#311E5C] hover:border-b-2 hover:border-[#FFC42E]/70 transition{% endif %}">
            Dashboard
          </a>
        </li>
        <li>
          <a href="{% url 'clientes:client_list' %}"
            class="inline-block px-3 py-2 {% if current_url == 'client_list' or current_url == 'client_create' or current_url == 'client_update' or current_url == 'client_delete' or current_url == 'client_transfer' or current_url == 'client_exit' or current_url == 'client_import' %}text-[#311E5C] border-b-2 border-[#FFC42E]{% else %}hover:text-[#311E5C] hover:border-b-2 hover:border-[#FFC42E]/70 transition{% endif %}">
            Clientes
          </a>
        </li>
        <li>
          <a href="{% url 'clientes:reunioes_lista' %}"
            class="inline-block px-3 py-2 {% if current_url == 'reunioes_lista' or current_url == 'reuniao_preferencias' %}text-[#311E5C] border-b-2 border-[#FFC42E]{% else %}hover:text-[#311E5C] hover:border-b-2 hover:border-[#FFC42E]/70 transition{% endif %}">
            Reuniões
          </a>
        </li>
        <li>
          <a href="{% url 'clientes:agendamentos' %}"
            class="inline-block px-3 py-2 {% if current_url == 'agendamentos' %}text-[#311E5C] border-b-2 border-[#FFC42E]{% else %}hover:text-[#311E5C] hover:border-b-2 hover:border-[#FFC42E]/70 transition{% endif %}">
            Agendamentos
          </a>
        </li>
      </ul>
    </nav>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
      <div class="p-6 border-b border-gray-100">
        <h2 class="text-xl font-semibold text-gray-900">Envio do arquivo</h2>
        <p class="text-sm text-gray-500">Colunas suportadas: CLIENTE, TERMÔMETRO, RESPONSÁVEL, STATUS, ENTRADA, SAÍDA,
          VALOR, PERMUTA, MOTIVO, RAZÃO.</p>
      </div>
      <div class="p-6">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
          {% csrf_token %}
          {{ form.as_p }}
          <div class="flex flex-col sm:flex-row sm:justify-between gap-3">
            <a class="inline-flex items-center justify-center px-4 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition"
              href="{% url 'clientes:client_list' %}">Cancelar</a>
            <button
              class="inline-flex items-center justify-center px-6 py-2.5 text-sm font-semibold text-white bg-[#311E5C] rounded-xl shadow-sm hover:bg-[#271547] transition"
              type="submit">Importar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>
{% endwith %}

{% if import_errors %}
<div class="modal fade" id="importErrorsModal" tabindex="-1" aria-labelledby="importErrorsLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="importErrorsLabel">Erros ao importar</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <p>O arquivo não foi importado. Corrija os itens abaixo e tente novamente:</p>
        <ul class="list-group list-group-flush">
          {% for erro in import_errors %}
          <li class="list-group-item text-danger">{{ erro }}</li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var modalEl = document.getElementById("importErrorsModal");
    if (modalEl) {
      var modal = new bootstrap.Modal(modalEl);
      modal.show();
    }
  });
</script>
{% endif %}
{% endblock %}