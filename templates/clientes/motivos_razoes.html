{% extends "base.html" %}

{% block title %}Motivos e Razões{% endblock %}

{% block content %}
{% with current_url=request.resolver_match.url_name %}
<main class="pt-8 pb-16 bg-gray-50 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">

    <div class="flex flex-wrap items-center gap-4 mb-4">
      <a href="{% url 'clientes:client_list' %}" class="inline-flex h-11 w-11 items-center justify-center rounded-full border-2 border-[#D0D5DD] bg-white text-[#311E5C] shadow-sm hover:border-[#FFC42E] hover:bg-[#FFF4DB]/50 focus:outline-none focus:ring-4 focus:ring-[#FFC42E]/30 transition">
          <i data-lucide="arrow-left" class="h-5 w-5"></i>
          <span class="sr-only">Voltar</span>
      </a>
      <h1 class="text-2xl md:text-3xl font-semibold text-[#311E5C]">Gestão de Motivos e Razões</h1>
    </div>

    <nav class="border-b border-[#C9CBCC]/60 mb-4">
      <ul class="flex flex-wrap gap-4 text-sm font-medium text-[#311E5C]/80">
        <li>
          <a href="{% url 'clientes:responsaveis' %}"
            class="inline-block px-3 py-2 {% if current_url == 'responsaveis' %}text-[#311E5C] border-b-2 border-[#FFC42E]{% else %}hover:text-[#311E5C] hover:border-b-2 hover:border-[#FFC42E]/70 transition{% endif %}">
            Responsáveis
          </a>
        </li>
        <li>
          <a href="{% url 'clientes:consultores' %}"
            class="inline-block px-3 py-2 {% if current_url == 'consultores' %}text-[#311E5C] border-b-2 border-[#FFC42E]{% else %}hover:text-[#311E5C] hover:border-b-2 hover:border-[#FFC42E]/70 transition{% endif %}">
            Consultores
          </a>
        </li>
        <li>
          <a href="{% url 'clientes:motivos_razoes' %}"
            class="inline-block px-3 py-2 {% if current_url == 'motivos_razoes' or current_url == 'client_create' or current_url == 'client_update' or current_url == 'client_delete' or current_url == 'client_transfer' or current_url == 'client_exit' or current_url == 'client_import' %}text-[#311E5C] border-b-2 border-[#FFC42E]{% else %}hover:text-[#311E5C] hover:border-b-2 hover:border-[#FFC42E]/70 transition{% endif %}">
            Motivos
          </a>
        </li>
      </ul>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white border border-gray-100 rounded-2xl shadow-sm h-full flex flex-col">
        <div class="p-6 border-b border-gray-100">
          <h2 class="text-lg font-semibold text-gray-900">Motivos</h2>
          <p class="text-sm text-gray-500">Itens utilizados em qualquer tipo de histórico.</p>
        </div>
        <div class="p-6 space-y-6">
          <form method="post" class="space-y-3">
            {% csrf_token %}
            {{ motivo_form.as_p }}
            <button class="inline-flex items-center justify-center px-4 py-2 text-sm font-semibold text-white bg-[#311E5C] rounded-xl hover:bg-[#271547] transition"
              type="submit">Adicionar</button>
          </form>
          <div class="border-t border-gray-100 pt-4">
            <ul class="space-y-3">
              {% for motivo in motivos %}
              <li class="bg-gray-50 rounded-xl p-3 space-y-2">
                <form method="post" class="flex flex-col gap-2">
                  {% csrf_token %}
                  <input type="hidden" name="editar_motivo" value="{{ motivo.pk }}">
                  <div class="flex flex-col gap-1">
                    <label class="text-xs text-gray-500">Nome</label>
                    <input type="text" class="form-control form-control-sm" name="nome_motivo"
                      value="{{ motivo.nome }}" required>
                  </div>
                  <button class="inline-flex justify-center items-center px-3 py-1.5 text-xs font-medium text-[#311E5C] bg-white rounded-lg border border-[#311E5C]/30 hover:bg-[#311E5C]/5"
                    type="submit">Salvar</button>
                </form>
                <form method="post" class="text-right">
                  {% csrf_token %}
                  <input type="hidden" name="remover_motivo" value="{{ motivo.pk }}">
                  <button class="inline-flex items-center justify-center px-3 py-1.5 text-xs font-medium text-red-600 bg-red-50 rounded-lg border border-red-100 hover:bg-red-100"
                    onclick="return confirm('Remover motivo?');">Remover</button>
                </form>
              </li>
              {% empty %}
              <li class="text-sm text-gray-500">Nenhum motivo cadastrado.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <div class="bg-white border border-gray-100 rounded-2xl shadow-sm h-full flex flex-col">
        <div class="p-6 border-b border-gray-100">
          <h2 class="text-lg font-semibold text-gray-900">Razões por tipo</h2>
          <p class="text-sm text-gray-500">Cada razão pertence a um motivo e a um tipo de histórico específico.</p>
        </div>
        <div class="p-6 space-y-6">
          <form method="post" class="space-y-3">
            {% csrf_token %}
            {{ razao_form.as_p }}
            <button class="inline-flex items-center justify-center px-4 py-2 text-sm font-semibold text-white bg-[#311E5C] rounded-xl hover:bg-[#271547] transition"
              type="submit">Adicionar</button>
          </form>
          <div class="border-t border-gray-100 pt-4">
            <ul class="space-y-3">
              {% for razao in razoes %}
              <li class="bg-gray-50 rounded-xl p-3 space-y-2">
                <form method="post" class="space-y-2">
                  {% csrf_token %}
                  <input type="hidden" name="editar_razao" value="{{ razao.pk }}">
                  <div class="flex flex-col gap-1">
                    <label class="text-xs text-gray-500">Nome</label>
                    <input type="text" class="form-control form-control-sm" name="nome_razao"
                      value="{{ razao.nome }}" required>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    <div class="flex flex-col gap-1">
                      <label class="text-xs text-gray-500">Tipo de histórico</label>
                      <select class="form-select form-select-sm" name="tipo_razao">
                        {% for value, label in tipo_choices %}
                        <option value="{{ value }}" {% if razao.tipo_de_historico == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="flex flex-col gap-1">
                      <label class="text-xs text-gray-500">Motivo associado</label>
                      <select class="form-select form-select-sm" name="motivo_razao">
                        {% for motivo in motivos %}
                        <option value="{{ motivo.pk }}" {% if razao.motivo_id == motivo.pk %}selected{% endif %}>{{ motivo.nome }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  <button class="inline-flex justify-center items-center px-3 py-1.5 text-xs font-medium text-[#311E5C] bg-white rounded-lg border border-[#311E5C]/30 hover:bg-[#311E5C]/5"
                    type="submit">Salvar</button>
                </form>
                <form method="post" class="text-right">
                  {% csrf_token %}
                  <input type="hidden" name="remover_razao" value="{{ razao.pk }}">
                  <button class="inline-flex items-center justify-center px-3 py-1.5 text-xs font-medium text-red-600 bg-red-50 rounded-lg border border-red-100 hover:bg-red-100"
                    onclick="return confirm('Remover razão?');">Remover</button>
                </form>
              </li>
              {% empty %}
              <li class="text-sm text-gray-500">Nenhuma razão cadastrada.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white border border-gray-100 rounded-2xl shadow-sm">
      <div class="p-6 border-b border-gray-100">
        <h2 class="text-lg font-semibold text-gray-900">Importação em massa</h2>
        <p class="text-sm text-gray-500">Colunas suportadas: <code>MOTIVO</code>, <code>RAZAO</code> e
          <code>TIPO</code> (transferencia, alteracao_de_valor, registro_de_saida ou alteracao_de_termometro).
        </p>
      </div>
      <div class="p-6">
        <form method="post" enctype="multipart/form-data" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="importar_motivos" value="1">
          {{ import_form.as_p }}
          <button
            class="inline-flex items-center justify-center px-5 py-2.5 text-sm font-semibold text-[#311E5C] border border-[#311E5C]/30 rounded-xl hover:bg-[#311E5C]/5 transition"
            type="submit">Importar arquivo</button>
        </form>
      </div>
    </div>
  </div>
</main>
{% endwith %}
{% endblock %}
